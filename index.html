<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FedEx - Ship. Track. Manage.</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'fedex-purple': '#663399',
                    'fedex-orange': '#ff6600'
                }
            }
        }
    }
</script>
<style>
    .gradient-bg {
        background: linear-gradient(135deg, #663399 0%, #552288 100%);
    }
    .hero-bg {
        background: linear-gradient(135deg, #663399 0%, #552288 100%);
        position: relative;
        overflow: hidden;
    }
    .hero-bg::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="50" opacity="0.1">‚úàÔ∏è</text></svg>'),
            url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="50" opacity="0.1">üöõ</text></svg>'),
            url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="50" opacity="0.1">üì¶</text></svg>');
        background-position: 85% 20%, 15% 80%, 75% 60%;
        background-repeat: no-repeat;
        background-size: 200px, 150px, 100px;
        z-index: 1;
    }
    .hero-content {
        position: relative;
        z-index: 2;
    }
    .status-delivered { background: #d4edda; color: #155724; }
    .status-in-transit { background: #d1ecf1; color: #0c5460; }
    .status-shipped { background: #fff3cd; color: #856404; }
    .status-out-for-delivery { background: #f8d7da; color: #721c24; }
    .status-error { background: #f8d7da; color: #721c24; }
    .status-unknown { background: #f8f9fa; color: #6c757d; }
    .tracking-timeline {
        position: relative;
    }
    .tracking-event {
        position: relative;
        padding-left: 2rem;
        margin-left: 0.5rem;
        border-left: 2px solid #e5e7eb;
        padding-bottom: 1rem;
    }
    .tracking-event::before {
        content: '';
        position: absolute;
        left: -5px;
        top: 0;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #663399;
    }
    .tracking-event.completed::before {
        background: #10b981;
    }
    .whatsapp-float {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 3.5rem;
        height: 3.5rem;
        background: #25d366;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-decoration: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: all 0.3s;
        z-index: 1000;
    }
    .whatsapp-float:hover {
        transform: scale(1.1);
        background: #20ba5a;
    }
    .admin-hidden {
        display: none;
    }
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</head>
<body class="bg-white">
<!-- Main Website -->
<div id="mainSite">
    <!-- Header -->
    <header class="border-b">
        <!-- Top Bar -->
        <div class="bg-gray-50 py-2">
            <div class="max-w-7xl mx-auto px-4 flex justify-between items-center text-sm">
                <div class="flex items-center gap-2 text-gray-600">
                    <span>English</span>
                    <i class="fas fa-globe"></i>
                </div>
                <div class="flex items-center gap-4 flex-wrap">
                    <a href="#" class="text-gray-600 hover:text-fedex-purple">Contact</a>
                    <a href="#" class="text-gray-600 hover:text-fedex-purple">Find Locations</a>
                    <a href="mailto:" class="flex items-center gap-1 bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">
                        <i class="fas fa-envelope"></i> Email Support
                    </a>
                    <a href="https://wa.me/17062481811" target="_blank" class="flex items-center gap-1 bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <button onclick="showAdminPanel()" class="bg-fedex-purple text-white px-3 py-1 rounded text-xs hover:bg-purple-700">
                        Management
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Header -->
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="text-3xl font-bold">
                <span class="text-fedex-purple">Fed</span><span class="text-fedex-orange">Ex</span>
            </div>

            <nav class="hidden md:flex items-center gap-8">
                <a href="#" class="text-gray-700 hover:text-fedex-purple font-medium">Track</a>
                <a href="#" class="text-gray-700 hover:text-fedex-purple font-medium">Support</a>
                <a href="#" class="text-gray-700 hover:text-fedex-purple font-medium">Locations</a>
            </nav>

            <div class="hidden md:flex items-center gap-4">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" placeholder="Search fedex.com" class="pl-10 pr-4 py-2 border border-gray-300 rounded-md w-64 focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                </div>
                <button class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                    <i class="fas fa-user"></i> Log In
                </button>
                <button class="p-2 border border-gray-300 rounded-md hover:bg-gray-50">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg text-white py-20">
        <div class="max-w-7xl mx-auto px-4 hero-content">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h1 class="text-5xl font-bold mb-6">Track Your Package</h1>
                    <p class="text-xl mb-8 text-purple-100">
                        Get real-time updates on your packages with our advanced tracking system. Fast, reliable, and secure delivery worldwide.
                    </p>

                    <div class="grid grid-cols-2 gap-6">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-clock text-3xl text-fedex-orange"></i>
                            <div>
                                <div class="font-semibold">Next Day</div>
                                <div class="text-sm text-purple-200">Delivery Available</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="fas fa-map-marker-alt text-3xl text-fedex-orange"></i>
                            <div>
                                <div class="font-semibold">220+ Countries</div>
                                <div class="text-sm text-purple-200">Worldwide Coverage</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="bg-white bg-opacity-10 backdrop-blur border border-white border-opacity-20 rounded-lg p-6 text-center">
                        <h3 class="text-2xl font-semibold mb-4 text-white">Professional Package Tracking</h3>
                        <p class="text-purple-100">
                            Track multiple packages with detailed information and real-time updates. Use our comprehensive tracking system below for complete package details.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tracking Section -->
    <section class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4">Track Your Shipments</h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Get real-time updates on your packages with our advanced tracking system
                </p>
            </div>

            <div class="grid lg:grid-cols-2 gap-12">
                <!-- Tracking Form -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-6">Enter Tracking Information</h3>
                    <form id="trackingForm" class="space-y-4">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            <textarea 
                                id="trackingInput" 
                                placeholder="Enter up to 30 tracking numbers (one per line)

Try these sample numbers:
1234567890
9876543210
5555666677
7777888899"
                                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-md min-h-32 focus:outline-none focus:ring-2 focus:ring-fedex-purple resize-none"
                            ></textarea>
                        </div>
                        <button type="submit" class="w-full bg-fedex-orange text-white py-3 px-6 rounded-md font-semibold hover:bg-orange-600 transition-colors">
                            <span id="trackingButtonText">Track Packages</span>
                            <i id="trackingSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                        </button>
                    </form>

                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-medium mb-3">Other Tracking Options:</h4>
                        <div class="space-y-2">
                            <button class="w-full text-left px-4 py-3 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                Track by Reference
                            </button>
                            <button class="w-full text-left px-4 py-3 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                Track by Door Tag Number
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tracking Results -->
                <div id="trackingResults" class="space-y-4">
                    <!-- Results will be displayed here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section class="py-20">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4">Our Services</h2>
                <p class="text-xl text-gray-600">
                    Choose from our comprehensive range of shipping and logistics solutions
                </p>
            </div>

            <div class="grid md:grid-cols-3 gap-8 mb-16">
                <div class="bg-white rounded-lg shadow-lg p-8 text-center hover:shadow-xl transition-shadow">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-bolt text-2xl text-fedex-purple"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">FedEx Express</h3>
                    <p class="text-gray-600 mb-4">Fast, reliable express delivery worldwide</p>
                    <ul class="text-sm text-gray-600 space-y-1 mb-6 text-left">
                        <li>‚Ä¢ Next business day</li>
                        <li>‚Ä¢ International express</li>
                        <li>‚Ä¢ Time-definite delivery</li>
                    </ul>
                    <button class="w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">Learn More</button>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-8 text-center hover:shadow-xl transition-shadow">
                    <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-truck text-2xl text-fedex-orange"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">FedEx Ground</h3>
                    <p class="text-gray-600 mb-4">Cost-effective ground shipping solutions</p>
                    <ul class="text-sm text-gray-600 space-y-1 mb-6 text-left">
                        <li>‚Ä¢ 1-5 business days</li>
                        <li>‚Ä¢ Residential delivery</li>
                        <li>‚Ä¢ Commercial delivery</li>
                    </ul>
                    <button class="w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">Learn More</button>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-8 text-center hover:shadow-xl transition-shadow">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-box text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">FedEx Freight</h3>
                    <p class="text-gray-600 mb-4">Less-than-truckload freight services</p>
                    <ul class="text-sm text-gray-600 space-y-1 mb-6 text-left">
                        <li>‚Ä¢ LTL shipping</li>
                        <li>‚Ä¢ Freight management</li>
                        <li>‚Ä¢ Supply chain solutions</li>
                    </ul>
                    <button class="w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">Learn More</button>
                </div>
            </div>

            <!-- Why Choose Us -->
            <div class="bg-gray-50 rounded-lg p-12 text-center">
                <h3 class="text-2xl font-semibold mb-8">Why Choose Us</h3>
                <div class="grid md:grid-cols-3 gap-8">
                    <div>
                        <i class="fas fa-shield-alt text-4xl text-fedex-purple mb-4"></i>
                        <h4 class="text-lg font-semibold mb-2">Secure & Reliable</h4>
                        <p class="text-gray-600">Your packages are protected with advanced security measures</p>
                    </div>
                    <div>
                        <i class="fas fa-globe text-4xl text-fedex-purple mb-4"></i>
                        <h4 class="text-lg font-semibold mb-2">Global Network</h4>
                        <p class="text-gray-600">Reach over 220 countries and territories worldwide</p>
                    </div>
                    <div>
                        <i class="fas fa-clock text-4xl text-fedex-purple mb-4"></i>
                        <h4 class="text-lg font-semibold mb-2">Time-Definite</h4>
                        <p class="text-gray-600">Guaranteed delivery times you can count on</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="text-2xl font-bold mb-4">
                        <span class="text-purple-400">Fed</span><span class="text-orange-400">Ex</span>
                    </div>
                    <p class="text-gray-400 mb-4">Connecting people and possibilities around the world.</p>
                    <p class="text-gray-400 text-sm mb-4">
                        <i class="fas fa-envelope mr-1"></i> 
                    </p>
                    <div class="flex gap-3">
                        <a href="#" class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-content hover:bg-gray-600">
                            <i class="fab fa-facebook-f text-sm"></i>
                        </a>
                        <a href="#" class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-content hover:bg-gray-600">
                            <i class="fab fa-twitter text-sm"></i>
                        </a>
                        <a href="#" class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-content hover:bg-gray-600">
                            <i class="fab fa-linkedin-in text-sm"></i>
                        </a>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Our Company</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-white">About FedEx</a></li>
                        <li><a href="#" class="hover:text-white">Investor Relations</a></li>
                        <li><a href="#" class="hover:text-white">Careers</a></li>
                        <li><a href="#" class="hover:text-white">FedEx Blog</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Services</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-white">FedEx Express</a></li>
                        <li><a href="#" class="hover:text-white">FedEx Ground</a></li>
                        <li><a href="#" class="hover:text-white">FedEx Freight</a></li>
                        <li><a href="#" class="hover:text-white">FedEx Office</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" class="hover:text-white">Customer Support</a></li>
                        <li><a href="#" class="hover:text-white">Shipping Tools</a></li>
                        <li><a href="#" class="hover:text-white">Developer Resources</a></li>
                        <li><a href="#" class="hover:text-white">Service Updates</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-8 flex flex-col md:flex-row justify-between items-center">
                <div class="flex flex-wrap gap-6 text-sm text-gray-400 mb-4 md:mb-0">
                    <a href="#" class="hover:text-white">Site Map</a>
                    <a href="#" class="hover:text-white">Terms of Use</a>
                    <a href="#" class="hover:text-white">Privacy Policy</a>
                    <a href="#" class="hover:text-white">Security</a>
                </div>
                <div class="text-sm text-gray-400">¬© 2024 FedEx. All rights reserved.</div>
            </div>
        </div>
    </footer>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-hidden min-h-screen bg-gray-50">
    <header class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="text-2xl font-bold">
                    <span class="text-fedex-purple">Fed</span><span class="text-fedex-orange">Ex</span>
                </div>
                <span class="text-gray-600">Management</span>
            </div>
            <div class="flex gap-3">
                <button onclick="showMainSite()" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                    Back to Site
                </button>
                <button onclick="logout()" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    Logout
                </button>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow p-4">
                <nav class="space-y-2">
                    <button onclick="showAdminSection('packages')" id="packagesTab" class="w-full text-left px-4 py-3 bg-fedex-purple text-white rounded-md">
                        <i class="fas fa-box mr-2"></i> Manage Packages
                    </button>
                    <button onclick="showAdminSection('add-package')" id="addPackageTab" class="w-full text-left px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-md">
                        <i class="fas fa-plus mr-2"></i> Add Package
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="lg:col-span-3">
            <!-- Manage Packages Section -->
            <div id="packagesSection" class="bg-white rounded-lg shadow">
                <div class="p-6 border-b">
                    <h2 class="text-xl font-semibold mb-4">Manage Packages</h2>
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="packageSearch" placeholder="Search packages..." class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                        <select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                            <option value="">All Status</option>
                            <option value="shipped">Shipped</option>
                            <option value="in-transit">In Transit</option>
                            <option value="out-for-delivery">Out for Delivery</option>
                            <option value="delivered">Delivered</option>
                        </select>
                    </div>
                </div>
                <div class="p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full" id="packagesTable">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-left p-3">Tracking Number</th>
                                    <th class="text-left p-3">Recipient</th>
                                    <th class="text-left p-3">Status</th>
                                    <th class="text-left p-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="packagesTableBody">
                                <!-- Packages will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Add Package Section -->
            <div id="addPackageSection" class="bg-white rounded-lg shadow admin-hidden">
                <div class="p-6 border-b">
                    <h2 id="addPackageTitle" class="text-xl font-semibold">Add New Package</h2>
                </div>
                <div class="p-6">
                    <form id="addPackageForm" class="space-y-6">
                        <!-- Image Upload -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <h3 class="text-lg font-medium mb-4 text-fedex-purple">Package Image</h3>
                            <div class="space-y-4">
                                <div>
                                    <input type="file" id="packageImageInput" accept="image/*" class="hidden">
                                    <button type="button" onclick="document.getElementById('packageImageInput').click()" class="px-4 py-2 bg-fedex-purple text-white rounded-md hover:bg-purple-700">
                                        <i class="fas fa-camera mr-2"></i> Upload Package Image
                                    </button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="url" id="imageUrlInput" placeholder="Or paste image URL here" class="flex-1 px-3 py-2 border border-gray-300 rounded-md">
                                    <button type="button" onclick="loadImageFromUrl()" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                                        Load Image
                                    </button>
                                </div>
                            </div>
                            <img id="imagePreview" class="hidden mt-4 max-w-48 max-h-48 mx-auto rounded-lg shadow-md" alt="Package Preview">
                        </div>

                        <!-- Form Fields -->
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Tracking Number</label>
                                <input type="text" id="trackingNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple" placeholder="Auto-generated if empty" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Recipient Name *</label>
                                <input type="text" id="recipientName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Recipient Address *</label>
                                <textarea id="recipientAddress" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple resize-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Sender Name *</label>
                                <input type="text" id="senderName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Weight (lbs) *</label>
                                <input type="number" id="packageWeight" step="0.1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Service Type *</label>
                                <select id="serviceType" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                                    <option value="">Select Service</option>
                                    <option value="FedEx Express">FedEx Express</option>
                                    <option value="FedEx Ground">FedEx Ground</option>
                                    <option value="FedEx Freight">FedEx Freight</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Status *</label>
                                <select id="packageStatus" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                                    <option value="shipped">Shipped</option>
                                    <option value="in-transit">In Transit</option>
                                    <option value="out-for-delivery">Out for Delivery</option>
                                    <option value="delivered">Delivered</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Estimated Delivery *</label>
                                <input type="date" id="estimatedDelivery" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-fedex-purple">
                            </div>
                        </div>
                        
                        <!-- Events Section -->
                        <div class="border-t border-gray-200 pt-6 mt-6">
                            <h3 class="text-lg font-medium mb-4 text-fedex-purple">Tracking Events</h3>
                            <div id="eventsContainer" class="space-y-4">
                                <!-- Event inputs will be added here -->
                            </div>
                            <button type="button" onclick="addEventField()" class="mt-4 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                <i class="fas fa-plus mr-2"></i> Add Event
                            </button>
                        </div>

                        <div class="flex gap-4">
                            <button type="submit" id="submitPackageButton" class="flex-1 bg-fedex-purple text-white py-3 px-6 rounded-md font-semibold hover:bg-purple-700 transition-colors">
                                Add Package
                            </button>
                            <button type="button" id="cancelEditButton" onclick="resetAddPackageForm()" class="hidden flex-1 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                Cancel Edit
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- WhatsApp Float Button -->
<a href="https://wa.me/17062481811" target="_blank" class="whatsapp-float">
    <i class="fab fa-whatsapp text-xl"></i>
</a>

<script>
(function() {
    'use strict';
    
    const API_BASE_URL = 'http://localhost:3000/api'; // Your Node.js backend URL

    // CORE PACKAGES DATABASE - These are hardcoded and always available
    // These will be merged with user-added packages from the backend
    const CORE_PACKAGES = {
        "1234567890": {
            trackingNumber: "1234567890",
            recipientName: "John Smith",
            recipientAddress: "123 Main St, New York, NY 10001",
            senderName: "Amazon Warehouse",
            weight: 2.5,
            serviceType: "FedEx Express",
            status: "delivered",
            estimatedDelivery: "2024-01-25",
            packageImage: "/placeholder.svg?height=200&width=200",
            events: [
                {
                    description: "Package delivered",
                    timestamp: "2024-01-25T14:30:00",
                    location: "New York, NY",
                    completed: true,
                },
                {
                    description: "Out for delivery",
                    timestamp: "2024-01-25T08:00:00",
                    location: "New York, NY",
                    completed: true,
                },
                {
                    description: "Package shipped",
                    timestamp: "2024-01-24T10:00:00",
                    location: "Newark, NJ",
                    completed: true,
                },
            ],
            createdAt: "2024-01-24T10:00:00",
            isGlobal: true
        },
        "9876543210": {
            trackingNumber: "9876543210",
            recipientName: "Sarah Johnson",
            recipientAddress: "789 Oak Ave, Los Angeles, CA 90210",
            senderName: "Best Buy",
            weight: 5.2,
            serviceType: "FedEx Ground",
            status: "in-transit",
            estimatedDelivery: "2024-01-26",
            packageImage: "/placeholder.svg?height=200&width=200",
            events: [
                {
                    description: "In transit",
                    timestamp: "2024-01-25T12:15:00",
                    location: "Phoenix, AZ",
                    completed: true,
                },
                {
                    description: "Package shipped",
                    timestamp: "2024-01-24T09:00:00",
                    location: "Memphis, TN",
                    completed: true,
                },
            ],
            createdAt: "2024-01-24T09:00:00",
            isGlobal: true
        },
        "5555666677": {
            trackingNumber: "5555666677",
            recipientName: "Mike Wilson",
            recipientAddress: "456 Pine St, Chicago, IL 60601",
            senderName: "Apple Store",
            weight: 1.2,
            serviceType: "FedEx Express",
            status: "out-for-delivery",
            estimatedDelivery: "2024-01-27",
            packageImage: "/placeholder.svg?height=200&width=200",
            events: [
                {
                    description: "Out for delivery",
                    timestamp: "2024-01-27T07:30:00",
                    location: "Chicago, IL",
                    completed: true,
                },
                {
                    description: "Arrived at facility",
                    timestamp: "2024-01-26T22:15:00",
                    location: "Chicago, IL",
                    completed: true,
                },
                {
                    description: "Package shipped",
                    timestamp: "2024-01-25T14:00:00",
                    location: "Cupertino, CA",
                    completed: true,
                },
            ],
            createdAt: "2024-01-25T14:00:00",
            isGlobal: true
        },
        "7777888899": {
            trackingNumber: "7777888899",
            recipientName: "Emma Davis",
            recipientAddress: "321 Oak Dr, Miami, FL 33101",
            senderName: "Nike Store",
            weight: 3.1,
            serviceType: "FedEx Ground",
            status: "shipped",
            estimatedDelivery: "2024-01-28",
            packageImage: "/placeholder.svg?height=200&width=200",
            events: [
                {
                    description: "Package shipped",
                    timestamp: "2024-01-26T11:00:00",
                    location: "Atlanta, GA",
                    completed: true,
                },
            ],
            createdAt: "2024-01-26T11:00:00",
            isGlobal: true
        }
    };

    let allPackages = {}; // Combined list of core and backend packages
    let currentPackageImageFile = null; // For file input
    let currentPackageImageUrl = null; // For URL input
    let isEditing = false;
    let editingTrackingNumber = null;

    // Utility functions
    function formatDateTime(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
            });
        } catch (error) {
            return dateString || 'N/A';
        }
    }

    function formatDate(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
            });
        } catch (error) {
            return dateString || 'N/A';
        }
    }

    function generateTrackingNumber() {
        return Math.random().toString().substr(2, 10);
    }

    function getStatusColor(status) {
        if (!status) {
            return 'status-unknown';
        }

        switch (status.toLowerCase()) {
            case 'delivered':
                return 'status-delivered';
            case 'in-transit':
                return 'status-in-transit';
            case 'shipped':
                return 'status-shipped';
            case 'out-for-delivery':
                return 'status-out-for-delivery';
            default:
                return 'status-unknown';
        }
    }

    // API Interaction Functions
    async function fetchPackages() {
        try {
            const response = await fetch(`${API_BASE_URL}/packages`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const backendPackages = await response.json();
            
            // Merge core packages with backend packages, backend packages override core if tracking numbers conflict
            allPackages = { ...CORE_PACKAGES };
            backendPackages.forEach(pkg => {
                allPackages[pkg.trackingNumber] = pkg;
            });
            console.log('All packages loaded:', allPackages);
        } catch (error) {
            console.error('Error fetching packages:', error);
            alert('Failed to load packages from backend. Please ensure the server is running.');
            allPackages = { ...CORE_PACKAGES }; // Fallback to core packages
        }
    }

    async function addPackage(packageData) {
        const formData = new FormData();
        for (const key in packageData) {
            if (key === 'events') {
                formData.append(key, JSON.stringify(packageData[key]));
            } else {
                formData.append(key, packageData[key]);
            }
        }
        if (currentPackageImageFile) {
            formData.append('packageImage', currentPackageImageFile);
        } else if (currentPackageImageUrl) {
            formData.append('packageImage', currentPackageImageUrl);
        } else {
            formData.append('packageImage', ''); // Send empty string if no image
        }

        try {
            const response = await fetch(`${API_BASE_URL}/packages`, {
                method: 'POST',
                body: formData,
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
            }
            const newPkg = await response.json();
            allPackages[newPkg.trackingNumber] = newPkg; // Add to local cache
            return true;
        } catch (error) {
            console.error('Error adding package:', error);
            alert(`Error adding package: ${error.message}`);
            return false;
        }
    }

    async function updatePackage(trackingNumber, packageData) {
        const formData = new FormData();
        for (const key in packageData) {
            if (key === 'events') {
                formData.append(key, JSON.stringify(packageData[key]));
            } else {
                formData.append(key, packageData[key]);
            }
        }
        if (currentPackageImageFile) {
            formData.append('packageImage', currentPackageImageFile);
        } else if (currentPackageImageUrl) {
            formData.append('packageImage', currentPackageImageUrl);
        } else {
            formData.append('packageImage', ''); // Send empty string if no image
        }

        try {
            const response = await fetch(`${API_BASE_URL}/packages/${trackingNumber}`, {
                method: 'PUT',
                body: formData,
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
            }
            const updatedPkg = await response.json();
            allPackages[updatedPkg.trackingNumber] = updatedPkg; // Update local cache
            return true;
        } catch (error) {
            console.error('Error updating package:', error);
            alert(`Error updating package: ${error.message}`);
            return false;
        }
    }

    async function deletePackageFromBackend(trackingNumber) {
        try {
            const response = await fetch(`${API_BASE_URL}/packages/${trackingNumber}`, {
                method: 'DELETE',
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
            }
            delete allPackages[trackingNumber]; // Remove from local cache
            return true;
        } catch (error) {
            console.error('Error deleting package:', error);
            alert(`Error deleting package: ${error.message}`);
            return false;
        }
    }

    // Tracking functions
    async function handleTracking(e) {
        e.preventDefault();
        
        const trackingInput = document.getElementById('trackingInput');
        const resultsDiv = document.getElementById('trackingResults');
        const buttonText = document.getElementById('trackingButtonText');
        const spinner = document.getElementById('trackingSpinner');
        
        if (!trackingInput || !resultsDiv || !buttonText || !spinner) {
            console.error('Required elements not found');
            return;
        }
        
        const inputValue = trackingInput.value.trim();
        if (!inputValue) {
            resultsDiv.innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Please enter at least one tracking number</div>';
            return;
        }
        
        const trackingNumbers = inputValue.split('\n').filter(num => num.trim());
        
        // Show loading state
        buttonText.textContent = 'Tracking...';
        spinner.classList.remove('hidden');
        
        // Ensure packages are loaded from backend
        await fetchPackages();
        
        let resultsHTML = '';
        let foundCount = 0;
        
        trackingNumbers.forEach(trackingNumber => {
            const trimmedNumber = trackingNumber.trim();
            if (trimmedNumber) {
                const pkg = allPackages[trimmedNumber];
                if (pkg) {
                    resultsHTML += generateTrackingCard(pkg);
                    foundCount++;
                } else {
                    resultsHTML += generateNotFoundCard(trimmedNumber);
                }
            }
        });
        
        resultsDiv.innerHTML = resultsHTML;
        resultsDiv.classList.add('fade-in');
        
        // Reset button state
        buttonText.textContent = 'Track Packages';
        spinner.classList.add('hidden');
        
        console.log(`Tracking completed: ${foundCount}/${trackingNumbers.length} packages found`);
    }

    function generateTrackingCard(pkg) {
        if (!pkg) {
            return '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Error: Package data not found</div>';
        }

        const safeStatus = pkg.status || 'unknown';
        const safeEvents = pkg.events || [];
        const statusClass = getStatusColor(safeStatus);
        
        const eventsHTML = safeEvents.map(event => `
            <div class="tracking-event ${event.completed ? 'completed' : ''}">
                <div>
                    <div class="font-medium">${event.description || 'N/A'}</div>
                    <div class="text-sm text-gray-600">${event.timestamp ? formatDateTime(event.timestamp) : 'N/A'}</div>
                    <div class="text-sm text-gray-600">${event.location || 'N/A'}</div>
                </div>
            </div>
        `).join('');

        const packageImageSrc = pkg.packageImage && pkg.packageImage.startsWith('/') ? 
                                `http://localhost:3000${pkg.packageImage}` : 
                                pkg.packageImage;

        const packageImageHTML = pkg.packageImage ? `
            <div class="text-center mb-6">
                <img src="${packageImageSrc}" alt="Package Image" class="max-w-48 max-h-48 rounded-lg shadow-md mx-auto" onerror="this.src='/placeholder.svg?height=200&width=200';" />
            </div>
        ` : '';

        return `
            <div class="space-y-4">
                <div class="gradient-bg text-white rounded-lg p-6 text-center">
                    <h3 class="text-xl font-semibold mb-2">Hello ${pkg.recipientName || 'Customer'}!</h3>
                    <p class="text-purple-100">
                        Your package was sent through FedEx and is being carefully handled throughout its journey to you. 
                        We're committed to delivering your package safely and on time.
                    </p>
                </div>
                
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-semibold">Tracking #: ${pkg.trackingNumber || 'N/A'}</span>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${statusClass}">${safeStatus}</span>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="space-y-2 text-sm">
                            <p><strong>Recipient:</strong> ${pkg.recipientName || 'N/A'}</p>
                            <p><strong>Destination:</strong> ${pkg.recipientAddress || 'N/A'}</p>
                            <p><strong>Sender:</strong> ${pkg.senderName || 'N/A'}</p>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p><strong>Service:</strong> ${pkg.serviceType || 'N/A'}</p>
                            <p><strong>Weight:</strong> ${pkg.weight || 'N/A'} lbs</p>
                            <p><strong>Estimated Delivery:</strong> ${pkg.estimatedDelivery ? formatDate(pkg.estimatedDelivery) : 'N/A'}</p>
                        </div>
                    </div>
                    
                    ${packageImageHTML}
                    
                    <div>
                        <h4 class="font-semibold mb-3">Tracking History</h4>
                        <div class="tracking-timeline">
                            ${eventsHTML}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function generateNotFoundCard(trackingNumber) {
        return `
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <span class="font-semibold">Tracking #: ${trackingNumber}</span>
                    <span class="px-3 py-1 rounded-full text-sm font-medium status-error">Not Found</span>
                </div>
                <p class="text-gray-600 mb-4">No information found for this tracking number.</p>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="font-medium text-blue-800 mb-2">Try these sample tracking numbers:</p>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ <button onclick="trackSample('1234567890')" class="text-blue-600 underline hover:text-blue-800">1234567890</button> (Delivered package)</li>
                        <li>‚Ä¢ <button onclick="trackSample('9876543210')" class="text-blue-600 underline hover:text-blue-800">9876543210</button> (In-transit package)</li>
                        <li>‚Ä¢ <button onclick="trackSample('5555666677')" class="text-blue-600 underline hover:text-blue-800">5555666677</button> (Out for delivery)</li>
                        <li>‚Ä¢ <button onclick="trackSample('7777888899')" class="text-blue-600 underline hover:text-blue-800">7777888899</button> (Recently shipped)</li>
                    </ul>
                </div>
            </div>
        `;
    }

    // Admin functions
    function showAdminPanel() {
        const password = prompt("Enter admin password:");
        if (password === "admin123") {
            document.getElementById('mainSite').classList.add('admin-hidden');
            document.getElementById('adminPanel').classList.remove('admin-hidden');
            showAdminSection('packages'); // Default to packages view
        } else {
            alert("Access denied");
        }
    }

    function showMainSite() {
        document.getElementById('adminPanel').classList.add('admin-hidden');
        document.getElementById('mainSite').classList.remove('admin-hidden');
    }

    function logout() {
        showMainSite();
    }

    function showAdminSection(section) {
        // Update tab states
        document.getElementById('packagesTab').className = 'w-full text-left px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-md';
        document.getElementById('addPackageTab').className = 'w-full text-left px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-md';
        
        // Hide all sections
        document.getElementById('packagesSection').classList.add('admin-hidden');
        document.getElementById('addPackageSection').classList.add('admin-hidden');
        
        if (section === 'packages') {
            document.getElementById('packagesTab').className = 'w-full text-left px-4 py-3 bg-fedex-purple text-white rounded-md';
            document.getElementById('packagesSection').classList.remove('admin-hidden');
            loadPackages();
        } else if (section === 'add-package') {
            document.getElementById('addPackageTab').className = 'w-full text-left px-4 py-3 bg-fedex-purple text-white rounded-md';
            document.getElementById('addPackageSection').classList.remove('admin-hidden');
            resetAddPackageForm(); // Reset form when switching to add/edit section
        }
    }

    function initializeAdminForm() {
        const trackingNumberInput = document.getElementById('trackingNumber');
        const estimatedDeliveryInput = document.getElementById('estimatedDelivery');
        
        if (trackingNumberInput) {
            trackingNumberInput.value = generateTrackingNumber();
        }
        
        if (estimatedDeliveryInput) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            estimatedDeliveryInput.value = tomorrow.toISOString().split('T')[0];
        }
        
        // Reset image previews and inputs
        currentPackageImageFile = null;
        currentPackageImageUrl = null;
        const imagePreview = document.getElementById('imagePreview');
        const imageUrlInput = document.getElementById('imageUrlInput');
        if (imagePreview) imagePreview.classList.add('hidden');
        if (imageUrlInput) imageUrlInput.value = '';

        // Reset events
        const eventsContainer = document.getElementById('eventsContainer');
        if (eventsContainer) eventsContainer.innerHTML = '';
        addEventField(); // Add one default event field
    }

    function resetAddPackageForm() {
        document.getElementById('addPackageForm').reset();
        document.getElementById('addPackageTitle').textContent = 'Add New Package';
        document.getElementById('submitPackageButton').textContent = 'Add Package';
        document.getElementById('cancelEditButton').classList.add('hidden');
        document.getElementById('trackingNumber').readOnly = false; // Allow editing for new package
        isEditing = false;
        editingTrackingNumber = null;
        initializeAdminForm();
    }

    function handleImageUpload(e) {
        const file = e.target.files[0];
        if (file) {
            currentPackageImageFile = file;
            currentPackageImageUrl = null; // Clear URL if file is uploaded
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('imagePreview');
                if (preview) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                }
            };
            reader.readAsDataURL(file);
        }
    }

    function loadImageFromUrl() {
        const imageUrlInput = document.getElementById('imageUrlInput');
        const imagePreview = document.getElementById('imagePreview');
        
        if (!imageUrlInput || !imagePreview) return;
        
        const imageUrl = imageUrlInput.value.trim();
        if (imageUrl) {
            currentPackageImageUrl = imageUrl;
            currentPackageImageFile = null; // Clear file if URL is used
            imagePreview.src = imageUrl;
            imagePreview.classList.remove('hidden');
            
            imagePreview.onload = function() {
                console.log('Image loaded successfully from URL');
            };
            
            imagePreview.onerror = function() {
                alert('Failed to load image from URL. Please check the URL.');
                imagePreview.classList.add('hidden');
                currentPackageImageUrl = null;
            };
        } else {
            imagePreview.classList.add('hidden');
            currentPackageImageUrl = null;
        }
    }

    function addEventField(description = '', timestamp = '', location = '', completed = true) {
        const eventsContainer = document.getElementById('eventsContainer');
        const eventIndex = eventsContainer.children.length;
        const eventDiv = document.createElement('div');
        eventDiv.className = 'flex flex-wrap gap-2 items-end border p-3 rounded-md relative';
        eventDiv.innerHTML = `
            <div class="flex-1 min-w-[150px]">
                <label class="block text-sm font-medium mb-1">Description</label>
                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md event-description" value="${description}">
            </div>
            <div class="flex-1 min-w-[150px]">
                <label class="block text-sm font-medium mb-1">Timestamp</label>
                <input type="datetime-local" class="w-full px-3 py-2 border border-gray-300 rounded-md event-timestamp" value="${timestamp ? timestamp.substring(0, 16) : ''}">
            </div>
            <div class="flex-1 min-w-[150px]">
                <label class="block text-sm font-medium mb-1">Location</label>
                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md event-location" value="${location}">
            </div>
            <div class="flex items-center min-w-[100px]">
                <input type="checkbox" class="mr-2 event-completed" ${completed ? 'checked' : ''}>
                <label class="text-sm font-medium">Completed</label>
            </div>
            <button type="button" onclick="removeEventField(this)" class="absolute top-2 right-2 text-red-500 hover:text-red-700">
                <i class="fas fa-times"></i>
            </button>
        `;
        eventsContainer.appendChild(eventDiv);
    }

    function removeEventField(button) {
        button.closest('.flex.flex-wrap.gap-2').remove();
    }

    function getEventsFromForm() {
        const events = [];
        const eventDivs = document.querySelectorAll('#eventsContainer > div');
        eventDivs.forEach(div => {
            const description = div.querySelector('.event-description').value;
            const timestamp = div.querySelector('.event-timestamp').value;
            const location = div.querySelector('.event-location').value;
            const completed = div.querySelector('.event-completed').checked;

            if (description && timestamp && location) {
                events.push({
                    description,
                    timestamp: new Date(timestamp).toISOString(),
                    location,
                    completed,
                });
            }
        });
        return events;
    }

    async function handleAddOrUpdatePackage(e) {
        e.preventDefault();
        
        const submitButton = document.getElementById('submitPackageButton');
        submitButton.disabled = true;
        submitButton.textContent = isEditing ? 'Updating...' : 'Adding...';

        const formData = {
            trackingNumber: document.getElementById('trackingNumber').value,
            recipientName: document.getElementById('recipientName').value,
            recipientAddress: document.getElementById('recipientAddress').value,
            senderName: document.getElementById('senderName').value,
            weight: parseFloat(document.getElementById('packageWeight').value),
            serviceType: document.getElementById('serviceType').value,
            status: document.getElementById('packageStatus').value,
            estimatedDelivery: document.getElementById('estimatedDelivery').value,
            events: getEventsFromForm(),
            // packageImage will be handled by FormData directly
        };

        let success = false;
        if (isEditing) {
            success = await updatePackage(editingTrackingNumber, formData);
        } else {
            success = await addPackage(formData);
        }
        
        if (success) {
            alert(`Package ${isEditing ? 'updated' : 'added'} successfully!`);
            resetAddPackageForm();
            showAdminSection('packages'); // Go back to package list
        } else {
            alert(`Error ${isEditing ? 'updating' : 'adding'} package. Please try again.`);
        }
        
        submitButton.disabled = false;
        submitButton.textContent = isEditing ? 'Update Package' : 'Add Package';
    }

    async function loadPackages() {
        await fetchPackages(); // Fetch latest data from backend
        const packagesArray = Object.values(allPackages);
        const tbody = document.getElementById('packagesTableBody');
        
        if (!tbody) return;
        
        tbody.innerHTML = packagesArray.map(pkg => `
            <tr class="border-b hover:bg-gray-50">
                <td class="p-3">${pkg.trackingNumber || 'N/A'}</td>
                <td class="p-3">${pkg.recipientName || 'N/A'}</td>
                <td class="p-3">
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(pkg.status)}">${pkg.status || 'unknown'}</span>
                </td>
                <td class="p-3 flex gap-2">
                    ${pkg.isGlobal ? 
                        '<span class="text-xs text-gray-500">Global Package</span>' : 
                        `
                        <button onclick="editPackage('${pkg.trackingNumber}')" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">Edit</button>
                        <button onclick="deletePackage('${pkg.trackingNumber}')" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">Delete</button>
                        `
                    }
                </td>
            </tr>
        `).join('');
        filterPackages(); // Apply current filters after loading
    }

    async function deletePackage(trackingNumber) {
        if (confirm('Are you sure you want to delete this package?')) {
            const success = await deletePackageFromBackend(trackingNumber);
            if (success) {
                loadPackages();
                alert('Package deleted successfully.');
            }
        }
    }

    function editPackage(trackingNumber) {
        const pkg = allPackages[trackingNumber];
        if (!pkg) {
            alert('Package not found for editing.');
            return;
        }

        isEditing = true;
        editingTrackingNumber = trackingNumber;

        // Populate form fields
        document.getElementById('addPackageTitle').textContent = `Edit Package: ${trackingNumber}`;
        document.getElementById('submitPackageButton').textContent = 'Update Package';
        document.getElementById('cancelEditButton').classList.remove('hidden');
        document.getElementById('trackingNumber').value = pkg.trackingNumber;
        document.getElementById('trackingNumber').readOnly = true; // Prevent changing tracking number during edit
        document.getElementById('recipientName').value = pkg.recipientName || '';
        document.getElementById('recipientAddress').value = pkg.recipientAddress || '';
        document.getElementById('senderName').value = pkg.senderName || '';
        document.getElementById('packageWeight').value = pkg.weight || '';
        document.getElementById('serviceType').value = pkg.serviceType || '';
        document.getElementById('packageStatus').value = pkg.status || 'shipped';
        document.getElementById('estimatedDelivery').value = pkg.estimatedDelivery ? pkg.estimatedDelivery.split('T')[0] : '';

        // Handle image preview
        const imagePreview = document.getElementById('imagePreview');
        const imageUrlInput = document.getElementById('imageUrlInput');
        if (pkg.packageImage) {
            imagePreview.src = pkg.packageImage.startsWith('/') ? `http://localhost:3000${pkg.packageImage}` : pkg.packageImage;
            imagePreview.classList.remove('hidden');
            currentPackageImageUrl = pkg.packageImage.startsWith('http') ? pkg.packageImage : null; // Only set URL if it's an external URL
            imageUrlInput.value = currentPackageImageUrl || '';
        } else {
            imagePreview.classList.add('hidden');
            imageUrlInput.value = '';
        }
        currentPackageImageFile = null; // Clear file input when editing

        // Populate events
        const eventsContainer = document.getElementById('eventsContainer');
        eventsContainer.innerHTML = ''; // Clear existing events
        if (pkg.events && pkg.events.length > 0) {
            pkg.events.forEach(event => {
                addEventField(event.description, event.timestamp, event.location, event.completed);
            });
        } else {
            addEventField(); // Add one empty event field if no events
        }

        showAdminSection('add-package'); // Switch to the add/edit package section
    }

    function filterPackages() {
        const searchInput = document.getElementById('packageSearch');
        const statusSelect = document.getElementById('statusFilter');
        
        if (!searchInput || !statusSelect) return;
        
        const searchTerm = searchInput.value.toLowerCase();
        const statusFilter = statusSelect.value;
        const packagesArray = Object.values(allPackages); // Use the combined list
        
        const filteredPackages = packagesArray.filter(pkg => {
            const matchesSearch = 
                (pkg.trackingNumber && pkg.trackingNumber.toLowerCase().includes(searchTerm)) ||
                (pkg.recipientName && pkg.recipientName.toLowerCase().includes(searchTerm)) ||
                (pkg.recipientAddress && pkg.recipientAddress.toLowerCase().includes(searchTerm));
            const matchesStatus = !statusFilter || pkg.status === statusFilter;
            return matchesSearch && matchesStatus;
        });
        
        const tbody = document.getElementById('packagesTableBody');
        if (!tbody) return;
        
        tbody.innerHTML = filteredPackages.map(pkg => `
            <tr class="border-b hover:bg-gray-50">
                <td class="p-3">${pkg.trackingNumber || 'N/A'}</td>
                <td class="p-3">${pkg.recipientName || 'N/A'}</td>
                <td class="p-3">
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(pkg.status)}">${pkg.status || 'unknown'}</span>
                </td>
                <td class="p-3 flex gap-2">
                    ${pkg.isGlobal ? 
                        '<span class="text-xs text-gray-500">Global Package</span>' : 
                        `
                        <button onclick="editPackage('${pkg.trackingNumber}')" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">Edit</button>
                        <button onclick="deletePackage('${pkg.trackingNumber}')" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">Delete</button>
                        `
                    }
                </td>
            </tr>
        `).join('');
    }

    function trackSample(trackingNumber) {
        const trackingInput = document.getElementById('trackingInput');
        if (trackingInput) {
            trackingInput.value = trackingNumber;
            handleTracking({ preventDefault: () => {} });
        }
    }

    // Make functions globally available
    window.showAdminPanel = showAdminPanel;
    window.showMainSite = showMainSite;
    window.logout = logout;
    window.showAdminSection = showAdminSection;
    window.loadImageFromUrl = loadImageFromUrl;
    window.deletePackage = deletePackage;
    window.editPackage = editPackage; // Make editPackage global
    window.trackSample = trackSample;
    window.addEventField = addEventField; // Make addEventField global
    window.removeEventField = removeEventField; // Make removeEventField global
    window.resetAddPackageForm = resetAddPackageForm; // Make reset function global

    // Initialize the application
    async function initializeApp() {
        console.log('FedEx Tracking System Initialized');
        
        // Set up event listeners
        const trackingForm = document.getElementById('trackingForm');
        const addPackageForm = document.getElementById('addPackageForm');
        const packageSearch = document.getElementById('packageSearch');
        const statusFilter = document.getElementById('statusFilter');
        const packageImageInput = document.getElementById('packageImageInput');
        
        if (trackingForm) trackingForm.addEventListener('submit', handleTracking);
        if (addPackageForm) addPackageForm.addEventListener('submit', handleAddOrUpdatePackage);
        if (packageSearch) packageSearch.addEventListener('input', filterPackages);
        if (statusFilter) statusFilter.addEventListener('change', filterPackages);
        if (packageImageInput) packageImageInput.addEventListener('change', handleImageUpload);
        
        // Initial load of packages (will fetch from backend)
        await fetchPackages();
        initializeAdminForm(); // Initialize form for adding new package
        
        console.log('Sample tracking numbers: 1234567890, 9876543210, 5555666677, 7777888899');
        console.log('Admin password: admin123');
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
        initializeApp();
    }

})();
</script>
</body>
</html>
